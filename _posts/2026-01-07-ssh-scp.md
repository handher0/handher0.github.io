---
layout: post
title: SSH, SCP를 활용한 원격 서버 파일 전송
date: 2026-01-07
categories: [tech]
tags: [ssh, scp, rsync, linux, server]
---

GPU 서버에서 생성한 3D 모델을 로컬로 가져오는 과정에서 SSH와 SCP에 대해 정리한 글입니다.

## 🤔 문제 상황
NeRF Studio로 3D 모델(`splat.ply`, 371MB)을 생성했습니다. 이제 원격 GPU 서버에 있는 이 파일을 내 Mac으로 어떻게 가져올까요?

```
GPU 서버 (Linux)          내 MacBook
    splat.ply      ->     로컬 저장
```

## 📚 SSH 기초 이해
### SSH란?
SSH (Secure Shell): 원격 서버에 안전하게 접속하는 프로토콜

```bash
# 기본 형식
ssh username@hostname

# 예시
ssh sslab2@gpu2
```

### SSH 연결의 구성 요소
```
ssh [사용자명]@[호스트] -p [포트]
     ↓         ↓         ↓
   sslab2    gpu2      2222
```

- 사용자명: 서버의 계정 이름
- 호스트: 서버 주소 (도메인 또는 IP)
- 포트: SSH 서비스 포트 (기본값: 22)

## 🔍 SSH 연결 정보 확인하기
### 내가 어떻게 접속했는지 확인
서버에 접속한 상태에서:

```bash
echo $SSH_CONNECTION
# 출력: 27.35.69.30 42615 203.253.25.80 2222
#       ↓            ↓     ↓              ↓
#     내 IP      내 포트  서버 IP      서버 포트
```

해석:
- 클라이언트(내 컴퓨터): 27.35.69.30:42615
- 서버(GPU 서버): 203.253.25.80:2222

### 호스트명 vs IP 주소
```bash
# 호스트명으로 접속
ssh sslab2@gpu2

# IP 주소로 접속
ssh sslab2@203.253.25.80
```

차이점:
- 호스트명(gpu2): 내부 네트워크나 `/etc/hosts`에 등록된 경우
- IP 주소: 어디서든 접속 가능 (공인 IP인 경우)

### 여러 IP가 나오는 경우
```bash
hostname -I
# 203.253.25.80 172.17.0.1 172.18.0.1 172.19.0.1
```

어떤 IP를 사용해야 할까?

| IP 대역 | 용도 | 외부 접속 |
| --- | --- | --- |
| 203.253.x.x | 공인 IP | ✅ 가능 |
| 172.17-19.x.x | Docker 네트워크 | ❌ 불가 |
| 192.168.x.x | 내부 사설 IP | ⚠️ 같은 네트워크만 |
| 10.x.x.x | 내부 사설 IP | ⚠️ 같은 네트워크만 |

결론: 외부에서 접속하려면 공인 IP(`203.253.25.80`) 사용

## 📦 SCP: 파일 전송의 기본
### SCP란?
SCP (Secure Copy): SSH를 이용한 안전한 파일 복사

```bash
# 기본 문법
scp [옵션] [출발지] [목적지]
```

### 원격 -> 로컬 (다운로드)
```bash
scp username@host:/remote/path/file.txt /local/path/
```

실제 예시:
```bash
scp sslab2@203.253.25.80:/home/sslab2/sso/data/exports/splat/splat.ply ./
```

요소 분석:
- `sslab2@203.253.25.80`: 원격 서버 접속 정보
- `:/home/sslab2/...`: 원격 파일 경로 (`:` 주의)
- `./`: 현재 디렉토리 (로컬)

### 로컬 -> 원격 (업로드)
```bash
scp /local/file.txt username@host:/remote/path/
```

## ⚠️ 트러블슈팅: 실제 겪은 문제들
### Issue #1: 호스트명 해석 실패
시도:
```bash
scp sslab2@gpu2:/home/sslab2/sso/data/exports/splat/*.ply ./
```

에러:
```
ssh: Could not resolve hostname gpu2: nodename nor servname provided, or not known
```

원인:
- gpu2는 서버 내부에서만 유효한 호스트명
- 내 Mac의 `/etc/hosts`에 gpu2 등록 안 됨

해결: IP 주소 사용
```bash
scp sslab2@203.253.25.80:/home/sslab2/sso/data/exports/splat/*.ply ./
```

### Issue #2: 포트 문제
시도:
```bash
scp sslab2@203.253.25.80:/path/to/file.ply ./
```

에러:
```
ssh: connect to host 203.253.25.80 port 22: Operation timed out
```

원인:
- SSH 기본 포트는 22번
- 서버는 2222번 포트 사용 중

포트 확인 방법:
```bash
# 서버에서
echo $SSH_CONNECTION
# 27.35.69.30 42615 203.253.25.80 2222
#                                  ↑ 포트 확인
```

해결: 포트 지정
```bash
scp -P 2222 sslab2@203.253.25.80:/path/to/file.ply ./
```

> ⚠️ ssh는 `-p` (소문자), scp는 `-P` (대문자)

### Issue #3: 비밀번호 입력 혼란
상황:
```bash
scp -P 2222 sslab2@203.253.25.80:/path/to/file.ply ./
sslab2@203.253.25.80's password:
```

원인:
- 비밀번호 입력 중 화면에 표시되지 않음 (정상)

올바른 절차:
1. Password 프롬프트 확인
2. 비밀번호 입력 (화면에 안 보임 ✅ 정상)
3. Enter
4. 파일 전송 시작

전송 중 화면:
```
splat.ply    45%  123MB   2.5MB/s   00:15 ETA
```

### 🎯 최종 성공 케이스
```bash
scp -P 2222 sslab2@203.253.25.80:/home/sslab2/sso/data/exports/splat/*.ply ./
```

결과:
```
sslab2@203.253.25.80's password:
splat.ply    100%  371MB   2.5MB/s   02:28
```

파일 확인:
```bash
ls -lh splat.ply
# -rw-r--r--  1 handher0  staff   371M Jan  7 20:45 splat.ply
```

## 📊 SCP 옵션 완전 정복
### 자주 사용하는 옵션
```bash
# 포트 지정 (대문자 P)
scp -P 2222 user@host:/path/file ./

# 재귀적 복사 (디렉토리)
scp -r user@host:/path/dir/ ./local_dir/

# 압축 전송 (대용량 파일)
scp -C user@host:/path/largefile ./

# 속도 제한 (KB/s)
scp -l 1000 user@host:/path/file ./

# Verbose (디버깅용)
scp -v user@host:/path/file ./

# 조합
scp -P 2222 -C -v user@host:/path/file ./
```

### 고급 사용법
```bash
# 여러 파일 동시 전송
scp -P 2222 user@host:"/path/*.ply" ./

# 디렉토리 전체 복사
scp -P 2222 -r user@host:/path/to/dir/ ./local_dir/

# 다른 이름으로 저장
scp -P 2222 user@host:/path/file.ply ./renamed.ply
```

## 🚀 rsync: SCP의 강력한 대안
대용량 파일이나 중단된 전송을 재개하려면 rsync가 더 좋습니다.

```bash
rsync -avz -e "ssh -p 2222" \
  sslab2@203.253.25.80:/home/sslab2/sso/data/exports/splat/ \
  ./local_dir/
```

옵션 설명:
- `-a`: archive (권한, 타임스탬프 유지)
- `-v`: verbose (진행 상황 표시)
- `-z`: 압축 전송
- `-e "ssh -p 2222"`: SSH 포트 지정

rsync의 장점:
- ✅ 중단된 전송 재개 가능
- ✅ 차이만 전송 (증분 백업)
- ✅ 진행률 표시
- ✅ 속도 제한 가능

SCP vs rsync 비교:

| 기능 | SCP | rsync |
| --- | --- | --- |
| 간단한 파일 전송 | ✅ 빠름 | ⚠️ 복잡 |
| 대용량 파일 | ⚠️ 중단 시 처음부터 | ✅ 재개 가능 |
| 증분 백업 | ❌ | ✅ |
| 속도 | 빠름 | 느릴 수 있음 |

## 🔐 SSH 키 기반 인증 (보너스)
매번 비밀번호 입력이 귀찮다면 SSH 키를 설정하세요.

### 1) SSH 키 생성 (로컬)
```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
# Enter -> Enter -> Enter (기본 설정)
```

### 2) 공개 키 서버로 복사
```bash
ssh-copy-id -p 2222 sslab2@203.253.25.80
```

### 3) 비밀번호 없이 접속
```bash
ssh -p 2222 sslab2@203.253.25.80
scp -P 2222 sslab2@203.253.25.80:/path/file ./
```

## 📱 GUI 도구 (비개발자용)
터미널이 어렵다면 GUI 도구를 사용하세요.

### Windows: WinSCP
- WinSCP 다운로드 및 설치
- 연결 정보 입력 (Host/Port/User)
- 드래그 앤 드롭으로 파일 전송

### Mac: Cyberduck
- Cyberduck 설치
- "Open Connection" -> SFTP 선택
- 서버 정보 입력 후 탐색기처럼 사용

### 크로스 플랫폼: FileZilla
- Windows, Mac, Linux 모두 지원
- SFTP 프로토콜 선택
- 포트 2222 지정

## 💡 실전 팁
### 1) SSH Config 파일 활용
```bash
# ~/.ssh/config
Host gpu-server
    HostName 203.253.25.80
    Port 2222
    User sslab2
```

이제 간단하게:
```bash
ssh gpu-server
scp gpu-server:/path/file ./
```

### 2) 전송 속도 확인
```bash
# pv (pipe viewer) 사용
apt-get install pv
tar czf - /large/directory | pv | ssh user@host 'tar xzf - -C /destination'
```

### 3) 백그라운드 전송
```bash
nohup scp -P 2222 user@host:/huge/file.tar.gz ./ &

# 진행 상황 확인
jobs
tail -f nohup.out
```

### 4) 전송 중 압축
```bash
# 압축하면서 전송
tar czf - /path/to/dir | ssh -p 2222 user@host 'cat > backup.tar.gz'

# 전송하면서 압축 풀기
ssh -p 2222 user@host 'cat file.tar.gz' | tar xzf -
```

## 🎓 핵심 정리
SSH 연결 확인 체크리스트:
```bash
# 1. 서버 IP 확인
hostname -I

# 2. SSH 연결 정보 확인
echo $SSH_CONNECTION

# 3. 포트 확인
# $SSH_CONNECTION의 마지막 숫자

# 4. 외부에서 테스트
ssh -p [포트] [사용자]@[IP]
```

SCP 명령어 템플릿:
```bash
# 원격 -> 로컬
scp -P [포트] [사용자]@[IP]:[원격경로] [로컬경로]

# 로컬 -> 원격
scp -P [포트] [로컬경로] [사용자]@[IP]:[원격경로]

# 디렉토리
scp -P [포트] -r [사용자]@[IP]:[원격경로] [로컬경로]
```

자주 하는 실수:
| 실수 | 올바른 방법 |
| --- | --- |
| scp -p 2222 | scp -P 2222 (대문자 P) |
| scp user@host/path | scp user@host:/path (:) |
| 호스트명 사용 | IP 주소 사용 권장 |
| 비밀번호 안 보임 당황 | 정상, 그대로 입력 후 Enter |

## 🔮 더 나아가기
### 포트 포워딩 (Tunneling)
```bash
ssh -p 2222 -L 7007:localhost:7007 sslab2@203.253.25.80
# 이제 localhost:7007로 접속하면 서버의 7007 포트에 연결
```

### 점프 호스트 (Bastion)
```bash
ssh -J user@bastion:2222 user@internal-server
```

### SSHFS (파일시스템 마운트)
```bash
sshfs -p 2222 sslab2@203.253.25.80:/remote/path ~/local/mount
```

## 📝 결론
처음에는 단순히 파일 하나를 가져오려던 시도가 SSH/SCP의 이해로 이어졌습니다. 배운 것:

- 호스트명 vs IP 주소의 차이
- SSH 포트가 항상 22번이 아닐 수 있다
- ssh `-p` vs scp `-P`의 차이
- 비밀번호 입력 시 화면에 표시되지 않는 것이 정상
- 공인 IP vs 내부 IP의 구분

실전 꿀팁:
- SSH config로 별칭 만들기
- SSH 키로 비밀번호 없이 접속
- GUI 도구도 훌륭한 대안
- 대용량은 rsync 고려

관련 문서:
- OpenSSH Manual
- SCP Man Page
- rsync Documentation
